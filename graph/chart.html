<head>
  <meta charset="utf-8" />
  <title>User statistics</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline/dist/chartjs-plugin-trendline.min.js"></script>
  <script src="firefoxUsers.js"></script>
  <script src="firefoxDownloads.js"></script>
  <script src="ChromeUsers.js"></script>
  <script src="ChromeDownloads.js"></script>
  <script src="chromeUninstall.js"></script>
  <script src="edgeUsers.js"></script>
  <script src="edgeDownloads.js"></script>
</head>

<body>
  <h2>Total Daily Users: <span id="totalDailyUsers"></span></h2>
  <h2>Estimated Total Users with chrome ratio: <span id="estimatedTotalUsers"></span></h2>
  <h2>Total Downloads: <span id="totalDownloads"></span></h2>
  <div style="display: flex;">
    <div style="width: 33%">
      Edge
      <canvas id="EdgeUsers"></canvas>
      <canvas id="EdgeDownloads"></canvas>
      <h2>Edge Max Users: <span id="emaxUsers"></span></h2>
    </div>
    <div style="width: 33%">
      Firefox
      <!-- https://www.chartjs.org/ -->
      <canvas id="users"></canvas>
      <canvas id="downloads"></canvas>
      <h2>Firefox Max Users: <span id="fmaxUsers"></span></h2>
    </div>
    <div style="width: 33%">
      Chrome
      <canvas id="ChromeUsers"></canvas>
      <canvas id="ChromeDownloads"></canvas>
      <canvas id="ChromeUninstall"></canvas>
      <h2>Chrome Max Users: <span id="cmaxUsers"></span></h2>
      <h2>Chrome Total Users: <span id="chromeTotalUsers"></span></h2>
      <h2>Chrome Retention Rate: <span id="ChromeRetentionRate"></span>%</h2>
      <h2>Chrome Ratio Max/Total Users: <span id="chromeRatioMaxTotal"></span></h2>
    </div>
  </div>
</body>

<script>
  const maxUsersFirefox = Math.max(...firefoxUsers.map((point) => point.count));
  const maxUsersChrome = Math.max(...chromeUsers.map((point) => point.count));
  const maxUsersEdge = Math.max(...edgeUsers.map((point) => point.count));
  const maxUsers = Math.ceil(Math.max(maxUsersFirefox, maxUsersChrome, maxUsersEdge) / 1000) * 1000;

  // chrome specific stats
  const chromeTotalUsers = chromeDownloads.reduce((acc, point) => acc + point.count, 0) - chromeUninstall.reduce((acc, point) => acc + point.count, 0);
  const ChromeRetentionRate = (chromeTotalUsers / chromeDownloads.reduce((acc, point) => acc + point.count, 0)) * 100;
  const chromeRatioMaxTotal = maxUsersChrome / chromeTotalUsers;

  const totalDailyUsers = firefoxUsers[0].count + chromeUsers[chromeUsers.length - 2].count + edgeUsers[edgeUsers.length - 1].count;
  const estimatedTotalUsers = Math.round(totalDailyUsers / chromeRatioMaxTotal); // rough estimate
  const totalDownloads = firefoxDownloads.reduce((acc, point) => acc + point.count, 0) + chromeDownloads.reduce((acc, point) => acc + point.count, 0) + edgeDownloads.reduce((acc, point) => acc + point.count, 0);

  document.getElementById("fmaxUsers").innerText = maxUsersFirefox;
  document.getElementById("cmaxUsers").innerText = maxUsersChrome;
  document.getElementById("emaxUsers").innerText = maxUsersEdge;
  document.getElementById("totalDailyUsers").innerText = totalDailyUsers;
  document.getElementById("estimatedTotalUsers").innerText = estimatedTotalUsers;
  document.getElementById("totalDownloads").innerText = totalDownloads;
  document.getElementById("chromeTotalUsers").innerText = chromeTotalUsers;
  document.getElementById("ChromeRetentionRate").innerText = ChromeRetentionRate.toFixed(2);
  document.getElementById("chromeRatioMaxTotal").innerText = chromeRatioMaxTotal.toFixed(2);
  new Chart(document.getElementById("users"), {
    type: "line",
    data: {
      labels: firefoxUsers.map((point) => point.date).reverse(),
      datasets: [
        {
          label: "Daily users",
          data: firefoxUsers.map((point) => point.count).reverse(),
          borderWidth: 1,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 1,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxUsers,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("downloads"), {
    type: "line",
    data: {
      labels: firefoxDownloads.map((point) => point.date).reverse(),
      datasets: [
        {
          label: "Downloads per Day",
          data: firefoxDownloads.map((point) => point.count).reverse(),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxDownloads,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("ChromeUsers"), {
    type: "line",
    data: {
      labels: chromeUsers.map((point) => point.date),
      datasets: [
        {
          label: "Daily users",
          data: chromeUsers.map((point) => point.count),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxUsers,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("ChromeDownloads"), {
    type: "line",
    data: {
      labels: chromeDownloads.map((point) => point.date),
      datasets: [
        {
          label: "Downloads per Day",
          data: chromeDownloads.map((point) => point.count),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxDownloads,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("ChromeUninstall"), {
    type: "line",
    data: {
      labels: chromeUninstall.map((point) => point.date),
      datasets: [
        {
          label: "Uninstalls per Day",
          data: chromeUninstall.map((point) => point.count),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxDownloads,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("EdgeUsers"), {
    type: "line",
    data: {
      labels: edgeUsers.map((point) => point.date),
      datasets: [
        {
          label: "Weekly users",
          data: edgeUsers.map((point) => point.count),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxUsers,
      //   },
      // },
    },
  });
  new Chart(document.getElementById("EdgeDownloads"), {
    type: "line",
    data: {
      labels: edgeDownloads.map((point) => point.date),
      datasets: [
        {
          label: "Downloads per Month",
          data: edgeDownloads.map((point) => point.count),
          borderWidth: 2,
          trendlineLinear: {
            lineStyle: "solid",
            width: 2,
          }
        },
      ],
    },
    options: {
      pointRadius: 3,
      // scales: {
      //   y: {
      //     min: 0,
      //     max: maxDownloads,
      //   },
      // },
    },
  });
</script>